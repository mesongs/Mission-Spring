<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="receipt.receiptDAO">
	
	<resultMap type="receiptVO" id="receiptMap">
		<result column="receipt_no" property="receiptNo" />
		<result column="SUPPLIER_BUSINESS_NO" property="supplierBusinessNo" />
		<result column="STORE_NAME" property="storeName" />
		<result column="RECEIPT_DATE" property="receiptDate" />
		<result column="REG_DATE" property="regDate" />
		<result column="receipt_name" property="receiptName" />
		<result column="receipt_code" property="receiptCode"/>
		<result column="receipt_status" property="receiptStatus" />
		<result column="business_no" property="businessNo" />
		<result column="file_path" property="filePath" />
		<result column="file_save_name" property="fileSaveName"/>
	</resultMap>
	
	<select id="getReceiptNo" resultType="int">
		SELECT RECEIPT_SEQ.NEXTVAL as receiptNo FROM DUAL
	</select>
	
	<insert id="receiptRegister" parameterType="receiptVO">
		insert into TB_RECEIPT(RECEIPT_NO, RECEIPT_CODE, SUPPLIER_BUSINESS_NO, STORE_NAME, RECEIPT_DATE,
                      		  AMOUNT, VAT, PURPOSE, MEMO, BUSINESS_NO)
            		values(#{receiptNo},#{receiptKind}, #{supplierBusinessNo}, 
            				#{storeName}, #{receiptDate}, #{amount}, #{vat}, #{purpose}, #{memo}, #{businessNo})
	</insert>
	
	<insert id="receiptFileRegister" parameterType="receiptVO">
		insert into tb_receipt_file(RECEIPT_NO, FILE_PATH, FILE_ORIGINAL_NAME, FILE_SAVE_NAME, FILE_SIZE)
            		values(#{receiptNo}, #{filePath}, #{fileOriginalName}, #{fileSaveName}, #{fileSize})
	</insert>
	
	<select id="getSeachWaitLst" parameterType="String" resultType="receiptVO" resultMap="receiptMap">
			select receipt_no, SUPPLIER_BUSINESS_NO, STORE_NAME, to_char(RECEIPT_DATE, 'yy/mm/dd') as RECEIPT_DATE, to_char(REG_DATE, 'yy/mm/dd') as REG_DATE, AMOUNT, vat, MEMO, purpose, receipt_name 
				from TB_RECEIPT a, TB_RECEIPT_KIND b     
				where a.RECEIPT_code = b.RECEIPT_code 
				and receipt_status ='W'
				and memo like '%'||#{searchWord}||'%'
				order by REG_DATE desc
	</select>
	
	<select id="waitAllList" resultType="receiptVO" resultMap="receiptMap">
			select receipt_no, SUPPLIER_BUSINESS_NO, STORE_NAME, to_char(RECEIPT_DATE, 'yy/mm/dd') as RECEIPT_DATE, to_char(REG_DATE, 'yy/mm/dd') as REG_DATE, AMOUNT, vat, MEMO, purpose, receipt_name
			from TB_RECEIPT a, TB_RECEIPT_KIND b     
			where a.RECEIPT_code = b.RECEIPT_code and
			receipt_status ='W'
			order by REG_DATE desc
	</select>
	
	<select id="processedAllList" resultType="receiptVO" resultMap="receiptMap">
			select * from (select receipt_no, SUPPLIER_BUSINESS_NO, STORE_NAME, to_char(RECEIPT_DATE, 'yy/mm/dd') as RECEIPT_DATE, to_char(REG_DATE, 'yy/mm/dd') as REG_DATE,
	        receipt_status,AMOUNT, vat, AMOUNT+VAT AS SUM, MEMO, purpose, receipt_name, overlap
			from TB_RECEIPT a, TB_RECEIPT_KIND b     
			where a.RECEIPT_code = b.RECEIPT_code and
			receipt_status ='P'
			order by RECEIPT_DATE desc) where rownum <![CDATA[ <= ]]> 15
	</select>
	
	<select id="getSeachProcessedList" parameterType="String" resultType="receiptVO" resultMap="receiptMap">
			select receipt_no, SUPPLIER_BUSINESS_NO, STORE_NAME, to_char(RECEIPT_DATE, 'yy/mm/dd') as RECEIPT_DATE, to_char(REG_DATE, 'yy/mm/dd') as REG_DATE,
		    receipt_status,AMOUNT, vat, AMOUNT+VAT AS SUM, MEMO, purpose, receipt_name, overlap
			from TB_RECEIPT a, TB_RECEIPT_KIND b     
			where a.RECEIPT_code = b.RECEIPT_code and
			receipt_status ='P'
			and memo like '%'||#{searchWord}||'%'
			order by RECEIPT_DATE desc
	</select>
	
	<select id="getSeachDateList" parameterType="searchDateVO" resultType="receiptVO" resultMap="receiptMap">
			select receipt_no, SUPPLIER_BUSINESS_NO, STORE_NAME, to_char(RECEIPT_DATE, 'yy/mm/dd') as RECEIPT_DATE, to_char(REG_DATE, 'yy/mm/dd') as REG_DATE,
		    receipt_status,AMOUNT, vat, AMOUNT+VAT AS SUM, MEMO, purpose, receipt_name, overlap
			from TB_RECEIPT a, TB_RECEIPT_KIND b     
			where a.RECEIPT_code = b.RECEIPT_code and
			receipt_status ='P'
            and RECEIPT_DATE between #{startDate} and #{endDate}
			order by RECEIPT_DATE desc
	</select>
	
	<select id="getReceiptKindList" parameterType="String" resultType="receiptVO" resultMap="receiptMap">
			select receipt_no, SUPPLIER_BUSINESS_NO, STORE_NAME, to_char(RECEIPT_DATE, 'yy/mm/dd') as RECEIPT_DATE, to_char(REG_DATE, 'yy/mm/dd') as REG_DATE,
		    receipt_status,AMOUNT, vat, AMOUNT+VAT AS SUM, MEMO, purpose, receipt_name, overlap
			from TB_RECEIPT a, TB_RECEIPT_KIND b     
			where a.RECEIPT_code = b.RECEIPT_code and
			receipt_status ='P'
            <if test="receiptKind != 000">
            	and b.receipt_code = #{receiptKind}
            </if>
            <if test="receiptKind == 000">
            	and b.receipt_code in (001, 002, 003, 004)
            </if>
			order by RECEIPT_DATE desc
	</select>
	
	<select id="getPerReceiptList" parameterType="int" resultType="receiptVO" resultMap="receiptMap">
			select * from (select receipt_no, SUPPLIER_BUSINESS_NO, STORE_NAME, to_char(RECEIPT_DATE, 'yy/mm/dd') as RECEIPT_DATE, to_char(REG_DATE, 'yy/mm/dd') as REG_DATE,
		    receipt_status,AMOUNT, vat, AMOUNT+VAT AS SUM, MEMO, purpose, receipt_name, overlap
			from TB_RECEIPT a, TB_RECEIPT_KIND b     
			where a.RECEIPT_code = b.RECEIPT_code and
			receipt_status ='P'
			order by RECEIPT_DATE desc)
            where rownum <![CDATA[ <= ]]> #{perReceipt}
	</select>
	
	<!-- 영수증 세부사항 조회 -->
	<select id="getReceiptDetail" parameterType="int" resultType="receiptVO" resultMap="receiptMap">
			select a.receipt_no, receipt_code, supplier_business_no, store_name,  to_char(RECEIPT_DATE, 'yy/mm/dd') as RECEIPT_DATE, amount, vat, overlap, receipt_status, purpose, file_path,
		        memo, business_no, file_save_name
				from TB_RECEIPT a, TB_RECEIPT_FILE b
				where a.receipt_no = b.receipt_no
				and a.receipt_no = #{receiptNo}
	</select>
	
</mapper>